"use strict";function _typeof(e){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}Object.defineProperty(exports,"__esModule",{value:!0}),exports.bezierCurveUtil=exports.progressUtil=void 0,window.ProgressUtil={},window.BezierCurveUtil={},function(e,t,o){var r,x=(r=o)&&r.__esModule?r:{default:r};function i(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!==_typeof(t)&&"function"!=typeof t?e:t}function a(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+_typeof(t));e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}function l(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var n=function(e,t,o){return t&&s(e.prototype,t),o&&s(e,o),e};function s(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var h="#00cccc",u="#006677",c="#003030",d="#000",f={Line:"line",Shield:"shield",Circle:"circle"},v={type:"",width:"",height:"",wrapDom:void 0,colors:{},minVal:void 0,maxVal:void 0,curVal:void 0,onChangeHandler:void 0},p=(n(w,[{key:"__init",value:function(){var e=this,t=e.options;if(!(e.wrapDom&&t.width&&t.height&&_.isString(e.type)))throw"Cannot init ProgressCanvas, please check arguments!";var o=document.createElement("canvas");switch(o.width=t.width,o.height=t.height,e.canvas=o,e.wrapDom.appendChild(e.canvas),e.context=o.getContext("2d"),e.options.ctx=e.context,e.type){case f.Circle:e.progress=new P(e.options);break;case f.Shield:e.progress=new b(e.options);break;case f.Line:default:e.progress=new m(e.options)}return e}},{key:"clearCanvas",value:function(){this.progress&&this.progress.clearCanvas()}},{key:"render",value:function(){this.progress&&this.progress.render()}},{key:"update",value:function(e){this.progress&&this.progress.updateVal(e)}}]),w);function w(e){l(this,w),this.options=_.extend({},v,e),this.wrapDom=this.options.wrapDom,this.type=this.options.type,this.canvas=void 0,this.context=void 0,this.progress=void 0,this.__init()}p.ProgressType=f;var y={showBackground:!1,gradientType:"radian",bgColors:[{stop:0,color:c},{stop:1,color:d}],lineWidth:5,lineCap:"round",useGradient:!1,lineColors:h,showShadow:!0,shadowBlur:8,shadowColor:u},g=(n(C,[{key:"__drawBase",value:function(){var e=this,t=e.options,o=e.ctx;if(o&&e.width&&e.height){this.clearCanvas();var r=void 0,i=void 0,a=e.width/2,l=e.height/2,n=Math.min(a,l);"radian"===t.gradientType?(i=o.createRadialGradient(a,l,5,a,l,n),r=o.createRadialGradient(a,l,5,a,l,n)):"linear"===t.gradientType&&(i=o.createLinearGradient(0,0,0,e.width),r=o.createLinearGradient(0,0,0,e.width)),t.showBackground&&t.bgColors&&(_.isString(t.bgColors)?o.fillStyle=t.bgColors:i&&_.isArray(t.bgColors)&&t.bgColors.length?(t.bgColors.forEach(function(e){i.addColorStop(e.stop,e.color)}),o.fillStyle=i):o.fillStyle=c,o.fillRect(0,0,e.width,e.height)),o.lineWidth=t.lineWidth,t.lineCap&&(o.lineCap=t.lineCap),t.lineColors&&(_.isString(t.lineColors)?o.strokeStyle=t.lineColors:t.useGradient&&_.isArray(t.lineColors)&&(t.lineColors.forEach(function(e){r.addColorStop(e.stop,e.color)}),o.strokeStyle=r)),t.showShadow&&(o.shadowBlur=t.shadowBlur||0,t.shadowColor&&(o.shadowColor=t.shadowColor)),o.save(),this.__drawProgress()}}},{key:"__drawProgress",value:function(){}},{key:"__dynamicDraw",value:function(t){var o=this,r=5;o.curVal=0,function e(){setTimeout(function(){o.curVal<t&&(o.curVal++,o.render(),e.call(o)),r=Math.tan(o.curVal*Math.PI/3/t)+5},r)}.call(o)}},{key:"render",value:function(){return this.__drawBase(),this}},{key:"clearCanvas",value:function(){var e=this.ctx;e&&e.clearRect(0,0,this.width,this.height)}},{key:"updateVal",value:function(e){void 0!==e&&(this.ctx.restore(),this.__dynamicDraw(e))}}]),C);function C(e){l(this,C),this.options=_.extend({},y,e),this.ctx=e.ctx,this.width=e.width,this.height=e.height,this.curVal=e.curVal||0,this.minVal=e.minVal||0,this.maxVal=e.maxVal||100,this.mainColor=e.mainColor||h}var b=(a(S,g),n(S,[{key:"__drawShield",value:function(){var e,t,o=this.options,r=this.ctx;e=t=Math.min(this.width,this.height);var i=Math.abs(this.width-this.height),a=0,l=0,n=0;this.width>this.height?(a=i/2,n=i):l=i/2;var s,h,u,c,d,f,v=[s=[.5*e+a,t/6+l],h=[.22*e+a,t/4+l]],p=[h,u=[.21*e+a,.5*t+l],c=[.25*e+a,.75*t+l],d=[e/2+a,.8*t+l]],w=[f=[e-h[0]+n,h[1]],[e-u[0]+n,u[1]],[e-c[0]+n,c[1]],d],y=[f,s],g={lineWidth:o.lineWidth,useGradient:o.useGradient,colors:o.lineColors,showShadow:o.showShadow,shadowBlur:o.shadowBlur,shadowColor:o.shadowColor},C=void 0,_=void 0,b=void 0,S=void 0;x.default.initCurveStyle(r,g),C=x.default.createBezierCurve(r,v),_=x.default.createBezierCurve(r,p),b=x.default.createBezierCurve(r,w),S=x.default.createBezierCurve(r,y),C.draw(),_.draw(),b.draw(),S.draw();var m=b.curvePoints.reverse(),k=S.curvePoints;m.shift(),k.pop(),this.totalPoints=[].concat(C.curvePoints).concat(_.curvePoints).concat(m).concat(k)}},{key:"getColorByVal",value:function(){return"#00e5d2"}},{key:"__drawProgress",value:function(){var e=this,t=e.ctx;if(t){var o=0,r=t.globalCompositeOperation;if(this.__drawShield(),0<=e.curVal&&this.totalPoints){var i=this.totalPoints.length,a=e.curVal/e.maxVal,l=t.shadowBlur,n=t.shadowColor,s=t.strokeStyle,h=t.fillStyle;o=a*i||1;var u=this.totalPoints.slice(0,o),c=e.options.color;t.strokeStyle=c,t.shadowBlur=0,x.default.drawCurveByNodes(t,u),t.fillStyle=c;var d=u[u.length?u.length-1:0];t.shadowBlur=60,t.shadowColor="#bcbcbc",t.fillStyle="#eee",t.beginPath(),t.arc(d[0],d[1],10,0,3*Math.PI),t.fill(),t.fillStyle=c,t.shadowBlur=0,this.__drawLabel(),t.strokeStyle=s,t.shadowBlur=l,t.shadowColor=n,t.fillStyle=h}t.globalCompositeOperation=r}}},{key:"__drawLabel",value:function(){var e=this.ctx,t=this.width/2,o=this.height/2;e.font='300 36px "Microsoft YaHei"',e.textAlign="center",e.fillStyle=this.options.valueColor||this.options.color,e.fillText(this.curVal,t,35+o),e.font='300 18px "Microsoft YaHei"',e.fillStyle=this.options.textColor||this.options.color,e.fillText(this.options.name,t,o-25)}},{key:"__dynamicDraw",value:function(t){var o=this,r=1;o.curVal=0;var i=t-t/10;(function e(){setTimeout(function(){o.curVal<t&&(o.curVal<=i&&10<=i&&(o.curVal+=5),o.curVal>i&&10<=i&&(o.curVal+=1),i<10&&(o.curVal+=1),o.render(),e.call(o)),r=.0156*Math.exp(.0526*o.curVal)},r)}).call(o)}}]),S);function S(e){return l(this,S),i(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,_.extend(e,{bgColorOpts:{gradientType:"radian"}})))}var m=(a(k,g),n(k,[{key:"__drawProgress",value:function(){var e=this.ctx,t=this.options;if(e){var o,r,i,a=void 0,l=this.width/20,n=this.height/2,s=l,h=n+t.lineWidth/2,u=e.strokeStyle,c=e.shadowBlur;e.font='400 28px "Microsoft YaHei"',e.textAlign="left",e.fillStyle="#fff";var d=e.measureText(this.maxVal).width;r=(o=this.width-l-d-10)-s,i=10+o,e.shadowBlur=0,e.fillText(this.maxVal,i,h),e.shadowBlur=c,e.strokeStyle="#1e306d",e.beginPath(),e.moveTo(s,n),e.lineTo(o,n),e.stroke(),e.strokeStyle=u,0<=this.curVal&&(a=this.curVal/this.maxVal*r+s,e.beginPath(),e.moveTo(s,n),e.lineTo(a,n),e.stroke(),this.__drawFlagAndCurVal(a,n,u))}}},{key:"__drawFlagAndCurVal",value:function(e,t){var o=this.ctx,r=this.options;if(o){var i=e,a=t-r.lineWidth/2-5,l=Math.sqrt(4*Math.pow(16,2)/3)/2,n=e-l,s=e+l,h=a-16,u=h,c=h-8,d=e,f=o.lineWidth,v=o.lineCap,p=o.fillStyle,w=o.shadowBlur;o.lineWidth=1,o.lineCap="butt",o.fillStyle="fillColor",o.beginPath(),o.moveTo(i,a),o.lineTo(n,h),o.lineTo(s,u),o.closePath(),o.fill(),o.shadowBlur=0,o.font='400 30px "Microsoft YaHei"',o.textAlign="center",o.fillStyle="#fff",o.fillText(this.curVal,d,c),o.shadowBlur=w,o.lineWidth=f,o.lineCap=v,o.fillStyle=p}}}]),k);function k(e){return l(this,k),i(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,_.extend(e,{bgColorOpts:{gradientType:"radian"}})))}var P=(a(B,g),n(B,[{key:"__drawProgress",value:function(){var e=this,t=e.ctx;if(this.options,t){var o=e.width/2,r=e.height/2,i=2*Math.min(o,r)/3,a=0,l=t.strokeStyle,n=t.fillStyle,s=t.shadowBlur,h="#253f95",u=t.createRadialGradient(o,r,.1*i,o,r,i);u.addColorStop(0,h),u.addColorStop(.67,"#10172e"),u.addColorStop(.97,"#10172e"),u.addColorStop(1,h),t.fillStyle=u,t.beginPath(),t.arc(o,r,i,V(0),V(360)),t.closePath(),t.fill(),t.strokeStyle=h,t.beginPath(),t.arc(o,r,i,V(0),V(360)),t.closePath(),t.stroke(),t.strokeStyle=l,t.fillStyle=n,0<e.curVal&&(a=360-e.curVal/e.maxVal*360-90,t.beginPath(),t.arc(o,r,i,V(270),V(a),!0),t.shadowBlur=0,t.stroke(),t.shadowBlur=s)}}},{key:"__dynamicDraw",value:function(t){var o=this,r=1;o.curVal=0,function e(){setTimeout(function(){o.curVal<t&&(o.curVal++,o.render(),e.call(o)),r=.1*Math.exp(.053*o.curVal)},r)}.call(o)}}]),B);function B(e){return l(this,B),i(this,(B.__proto__||Object.getPrototypeOf(B)).call(this,_.extend(e,{bgColorOpts:{gradientType:"radian"}})))}function V(e){return Math.PI/180*e}t.default=p}(window,window.ProgressUtil,function(e){function r(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var t=function(e,t,o){return t&&i(e.prototype,t),o&&i(e,o),e};function i(e,t){for(var o=0;o<t.length;o++){var r=t[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e){return e<=1?1:e*s(e-1)}var l={lineWidth:1,lineCap:"round",useGradient:!1,colors:[{stop:0,color:"#00c3c3"},{stop:1,color:"#111"}],showShadow:!0,shadowBlur:10,shadowColor:"#00ffff"},d=(t(a,[{key:"draw",value:function(){var e=this.ctx,t=this.curvePoints,o=this.renderOpts;e&&_.isArray(t)&&(_.isEmpty(o)||n.initCurveStyle(e,o),n.drawCurveByNodes(e,t))}}]),a);function a(e,t,o){r(this,a),this.ctx=e,this.nodes=t,this.renderOpts=o,this.curvePoints=n.calculateCurveNodes(t)}var n=(t(f,null,[{key:"calculateCurvePerNode",value:function(e,i){var a=void 0,l=void 0,n=void 0;return e.length?(a=l=0,n=e.length-1,e.forEach(function(e,t){var o=void 0,r=Math.pow(1-i,n-t)*Math.pow(i,t);o=0===t?r:s(n)/s(t)/s(n-t)*r,a+=e[0]*o,l+=e[1]*o}),[a,l]):[]}},{key:"createBezierCurve",value:function(e,t,o){return new d(e,t,o)}},{key:"initCurveStyle",value:function(e,t){if(e&&t){var o=void 0;o=t?_.extend({},l,t):_.extend({},l);var r=void 0;e.lineWidth=o.lineWidth||1,o.lineCap&&(e.lineCap=o.lineCap);var i=o.colors;if(_.isString(i))e.strokeStyle=i;else if(o.useGradient&&_.isArray(i)){var a=function(e){var t=void 0;if(e&&_.isArray(e)){var o,r,i=[],a=[];e.forEach(function(e){i.push(e[0]),a.push(e[1])}),o=_.sortBy(i),r=_.sortBy(a);var l=o.length-1,n=r.length-1;t=[o[0],r[0],o[l],r[n]]}return t}(nodes);r=a?e.createLinearGradient(a[0],a[1],a[2],a[3]):e.createLinearGradient(0,0,0,200),i.forEach(function(e){r.addColorStop(e.stop,e.color)}),e.strokeStyle=r}o.showShadow&&(e.shadowBlur=o.shadowBlur||10,o.shadowColor&&(e.shadowColor=o.shadowColor))}}},{key:"drawCurve",value:function(e,t,o,r){var i=3<arguments.length&&void 0!==r&&r,a=void 0;if(e&&t&&_.isArray(t)&&t.length){var l=t.length,n=void 0,s=void 0;if(f.initCurveStyle(e,o),a=f.calculateCurveNodes(t),2!==l||i)if(3!==l||i)if(4!==l||i)f.drawCurveByNodes(e,a);else{var h,u;n=t[0],h=t[1],u=t[2],s=t[3],e.beginPath(),e.moveTo(n[0],n[1]),e.bezierCurveTo(h[0],h[1],u[0],u[1],s[0],s[1]),e.stroke()}else{var c;n=t[0],c=t[1],s=t[2],e.beginPath(),e.moveTo(n[0],n[1]),e.quadraticCurveTo(c[0],c[1],s[0],s[1]),e.stroke()}else n=t[0],s=t[1],_.isArray(n)&&_.isArray(s)&&(e.beginPath(),e.moveTo(n[0],n[1]),e.lineTo(s[0],s[1]),e.stroke());e.closePath()}return new d(e,t,a)}},{key:"calculateCurveNodes",value:function(e){var t=[],o=void 0;if(e&&_.isArray(e)){o=1/(2===e.length?50:200);for(var r=0;r<1;r+=o)t.push(f.calculateCurvePerNode(e,r));t.push(e[e.length-1])}return t}},{key:"drawCurveByNodes",value:function(r,i){if(_.isArray(i)){var e=r.shadowBlur,t=function(){i.forEach(function(e,t){if(t){var o=i[t-1];r.beginPath(),r.moveTo(o[0],o[1]),r.lineTo(e[0],e[1]),r.stroke()}})};t(),r.shadowBlur=0,t(),r.shadowBlur=e}}}]),f);function f(){r(this,f)}return e.default=n,e}(window.BezierCurveUtil));var progressUtil=window.ProgressUtil;exports.progressUtil=progressUtil;var bezierCurveUtil=window.BezierCurveUtil;exports.bezierCurveUtil=bezierCurveUtil;