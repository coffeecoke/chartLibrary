"use strict";function _typeof(t){return(_typeof="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t})(t)}window.ProgressUtil={},window.BezierCurveUtil={},function(t,e,o){Object.defineProperty(e,"__esModule",{value:!0});var r,x=(r=o)&&r.__esModule?r:{default:r};function i(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!==_typeof(e)&&"function"!=typeof e?t:e}function a(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+_typeof(e));t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):t.__proto__=e)}function l(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}var n=function(t,e,o){return e&&s(t.prototype,e),o&&s(t,o),t};function s(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}var h="#00cccc",u="#006677",c="#003030",d="#000",f={Line:"line",Shield:"shield",Circle:"circle"},v={type:"",width:"",height:"",wrapDom:void 0,colors:{},minVal:void 0,maxVal:void 0,curVal:void 0,onChangeHandler:void 0},p=(n(w,[{key:"__init",value:function(){var t=this,e=t.options;if(!(t.wrapDom&&e.width&&e.height&&_.isString(t.type)))throw"Cannot init ProgressCanvas, please check arguments!";var o=document.createElement("canvas");switch(o.width=e.width,o.height=e.height,t.canvas=o,t.wrapDom.appendChild(t.canvas),t.context=o.getContext("2d"),t.options.ctx=t.context,t.type){case f.Circle:t.progress=new P(t.options);break;case f.Shield:t.progress=new b(t.options);break;case f.Line:default:t.progress=new m(t.options)}return t}},{key:"clearCanvas",value:function(){this.progress&&this.progress.clearCanvas()}},{key:"render",value:function(){this.progress&&this.progress.render()}},{key:"update",value:function(t){this.progress&&this.progress.updateVal(t)}}]),w);function w(t){l(this,w),this.options=_.extend({},v,t),this.wrapDom=this.options.wrapDom,this.type=this.options.type,this.canvas=void 0,this.context=void 0,this.progress=void 0,this.__init()}p.ProgressType=f;var y={showBackground:!1,gradientType:"radian",bgColors:[{stop:0,color:c},{stop:1,color:d}],lineWidth:5,lineCap:"round",useGradient:!1,lineColors:h,showShadow:!0,shadowBlur:8,shadowColor:u},g=(n(C,[{key:"__drawBase",value:function(){var t=this,e=t.options,o=t.ctx;if(o&&t.width&&t.height){this.clearCanvas();var r=void 0,i=void 0,a=t.width/2,l=t.height/2,n=Math.min(a,l);"radian"===e.gradientType?(i=o.createRadialGradient(a,l,5,a,l,n),r=o.createRadialGradient(a,l,5,a,l,n)):"linear"===e.gradientType&&(i=o.createLinearGradient(0,0,0,t.width),r=o.createLinearGradient(0,0,0,t.width)),e.showBackground&&e.bgColors&&(_.isString(e.bgColors)?o.fillStyle=e.bgColors:i&&_.isArray(e.bgColors)&&e.bgColors.length?(e.bgColors.forEach(function(t){i.addColorStop(t.stop,t.color)}),o.fillStyle=i):o.fillStyle=c,o.fillRect(0,0,t.width,t.height)),o.lineWidth=e.lineWidth,e.lineCap&&(o.lineCap=e.lineCap),e.lineColors&&(_.isString(e.lineColors)?o.strokeStyle=e.lineColors:e.useGradient&&_.isArray(e.lineColors)&&(e.lineColors.forEach(function(t){r.addColorStop(t.stop,t.color)}),o.strokeStyle=r)),e.showShadow&&(o.shadowBlur=e.shadowBlur||0,e.shadowColor&&(o.shadowColor=e.shadowColor)),o.save(),this.__drawProgress()}}},{key:"__drawProgress",value:function(){}},{key:"__dynamicDraw",value:function(e){var o=this,r=5;o.curVal=0,function t(){setTimeout(function(){o.curVal<e&&(o.curVal++,o.render(),t.call(o)),r=Math.tan(o.curVal*Math.PI/3/e)+5},r)}.call(o)}},{key:"render",value:function(){return this.__drawBase(),this}},{key:"clearCanvas",value:function(){var t=this.ctx;t&&t.clearRect(0,0,this.width,this.height)}},{key:"updateVal",value:function(t){void 0!==t&&(this.ctx.restore(),this.__dynamicDraw(t))}}]),C);function C(t){l(this,C),this.options=_.extend({},y,t),this.ctx=t.ctx,this.width=t.width,this.height=t.height,this.curVal=t.curVal||0,this.minVal=t.minVal||0,this.maxVal=t.maxVal||100,this.mainColor=t.mainColor||h}var b=(a(S,g),n(S,[{key:"__drawShield",value:function(){var t,e,o=this.options,r=this.ctx;t=e=Math.min(this.width,this.height);var i=Math.abs(this.width-this.height),a=0,l=0,n=0;this.width>this.height?(a=i/2,n=i):l=i/2;var s,h,u,c,d,f,v=[s=[.5*t+a,e/6+l],h=[.22*t+a,e/4+l]],p=[h,u=[.21*t+a,.5*e+l],c=[.25*t+a,.75*e+l],d=[t/2+a,.8*e+l]],w=[f=[t-h[0]+n,h[1]],[t-u[0]+n,u[1]],[t-c[0]+n,c[1]],d],y=[f,s],g={lineWidth:o.lineWidth,useGradient:o.useGradient,colors:o.lineColors,showShadow:o.showShadow,shadowBlur:o.shadowBlur,shadowColor:o.shadowColor},C=void 0,_=void 0,b=void 0,S=void 0;x.default.initCurveStyle(r,g),C=x.default.createBezierCurve(r,v),_=x.default.createBezierCurve(r,p),b=x.default.createBezierCurve(r,w),S=x.default.createBezierCurve(r,y),C.draw(),_.draw(),b.draw(),S.draw();var m=b.curvePoints.reverse(),k=S.curvePoints;m.shift(),k.pop(),this.totalPoints=[].concat(C.curvePoints).concat(_.curvePoints).concat(m).concat(k)}},{key:"getColorByVal",value:function(){return"#00e5d2"}},{key:"__drawProgress",value:function(){var t=this,e=t.ctx;if(e){var o=0,r=e.globalCompositeOperation;if(this.__drawShield(),0<=t.curVal&&this.totalPoints){var i=this.totalPoints.length,a=t.curVal/t.maxVal,l=e.shadowBlur,n=e.shadowColor,s=e.strokeStyle,h=e.fillStyle;o=a*i||1;var u=this.totalPoints.slice(0,o),c=t.options.color;e.strokeStyle=c,e.shadowBlur=0,x.default.drawCurveByNodes(e,u),e.fillStyle=c;var d=u[u.length?u.length-1:0];e.shadowBlur=60,e.shadowColor="#bcbcbc",e.fillStyle="#eee",e.beginPath(),e.arc(d[0],d[1],10,0,3*Math.PI),e.fill(),e.fillStyle=c,e.shadowBlur=0,this.__drawLabel(),e.strokeStyle=s,e.shadowBlur=l,e.shadowColor=n,e.fillStyle=h}e.globalCompositeOperation=r}}},{key:"__drawLabel",value:function(){var t=this.ctx,e=this.width/2,o=this.height/2;t.font='300 36px "Microsoft YaHei"',t.textAlign="center",t.fillStyle=this.options.valueColor||this.options.color,t.fillText(this.curVal,e,35+o),t.font='300 18px "Microsoft YaHei"',t.fillStyle=this.options.textColor||this.options.color,t.fillText(this.options.name,e,o-25)}},{key:"__dynamicDraw",value:function(e){var o=this,r=1;o.curVal=0;var i=e-e/10;(function t(){setTimeout(function(){o.curVal<e&&(o.curVal<=i&&10<=i&&(o.curVal+=5),o.curVal>i&&10<=i&&(o.curVal+=1),i<10&&(o.curVal+=1),o.render(),t.call(o)),r=.0156*Math.exp(.0526*o.curVal)},r)}).call(o)}}]),S);function S(t){return l(this,S),i(this,(S.__proto__||Object.getPrototypeOf(S)).call(this,_.extend(t,{bgColorOpts:{gradientType:"radian"}})))}var m=(a(k,g),n(k,[{key:"__drawProgress",value:function(){var t=this.ctx,e=this.options;if(t){var o,r,i,a=void 0,l=this.width/20,n=this.height/2,s=l,h=n+e.lineWidth/2,u=t.strokeStyle,c=t.shadowBlur;t.font='400 28px "Microsoft YaHei"',t.textAlign="left",t.fillStyle="#fff";var d=t.measureText(this.maxVal).width;r=(o=this.width-l-d-10)-s,i=10+o,t.shadowBlur=0,t.fillText(this.maxVal,i,h),t.shadowBlur=c,t.strokeStyle="#1e306d",t.beginPath(),t.moveTo(s,n),t.lineTo(o,n),t.stroke(),t.strokeStyle=u,0<=this.curVal&&(a=this.curVal/this.maxVal*r+s,t.beginPath(),t.moveTo(s,n),t.lineTo(a,n),t.stroke(),this.__drawFlagAndCurVal(a,n,u))}}},{key:"__drawFlagAndCurVal",value:function(t,e){var o=this.ctx,r=this.options;if(o){var i=t,a=e-r.lineWidth/2-5,l=Math.sqrt(4*Math.pow(16,2)/3)/2,n=t-l,s=t+l,h=a-16,u=h,c=h-8,d=t,f=o.lineWidth,v=o.lineCap,p=o.fillStyle,w=o.shadowBlur;o.lineWidth=1,o.lineCap="butt",o.fillStyle="fillColor",o.beginPath(),o.moveTo(i,a),o.lineTo(n,h),o.lineTo(s,u),o.closePath(),o.fill(),o.shadowBlur=0,o.font='400 30px "Microsoft YaHei"',o.textAlign="center",o.fillStyle="#fff",o.fillText(this.curVal,d,c),o.shadowBlur=w,o.lineWidth=f,o.lineCap=v,o.fillStyle=p}}}]),k);function k(t){return l(this,k),i(this,(k.__proto__||Object.getPrototypeOf(k)).call(this,_.extend(t,{bgColorOpts:{gradientType:"radian"}})))}var P=(a(B,g),n(B,[{key:"__drawProgress",value:function(){var t=this,e=t.ctx;if(this.options,e){var o=t.width/2,r=t.height/2,i=2*Math.min(o,r)/3,a=0,l=e.strokeStyle,n=e.fillStyle,s=e.shadowBlur,h="#253f95",u=e.createRadialGradient(o,r,.1*i,o,r,i);u.addColorStop(0,h),u.addColorStop(.67,"#10172e"),u.addColorStop(.97,"#10172e"),u.addColorStop(1,h),e.fillStyle=u,e.beginPath(),e.arc(o,r,i,V(0),V(360)),e.closePath(),e.fill(),e.strokeStyle=h,e.beginPath(),e.arc(o,r,i,V(0),V(360)),e.closePath(),e.stroke(),e.strokeStyle=l,e.fillStyle=n,0<t.curVal&&(a=360-t.curVal/t.maxVal*360-90,e.beginPath(),e.arc(o,r,i,V(270),V(a),!0),e.shadowBlur=0,e.stroke(),e.shadowBlur=s)}}},{key:"__dynamicDraw",value:function(e){var o=this,r=1;o.curVal=0,function t(){setTimeout(function(){o.curVal<e&&(o.curVal++,o.render(),t.call(o)),r=.1*Math.exp(.053*o.curVal)},r)}.call(o)}}]),B);function B(t){return l(this,B),i(this,(B.__proto__||Object.getPrototypeOf(B)).call(this,_.extend(t,{bgColorOpts:{gradientType:"radian"}})))}function V(t){return Math.PI/180*t}e.default=p}(window,window.ProgressUtil,function(t){function r(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}Object.defineProperty(t,"__esModule",{value:!0});var e=function(t,e,o){return e&&i(t.prototype,e),o&&i(t,o),t};function i(t,e){for(var o=0;o<e.length;o++){var r=e[o];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function s(t){return t<=1?1:t*s(t-1)}var l={lineWidth:1,lineCap:"round",useGradient:!1,colors:[{stop:0,color:"#00c3c3"},{stop:1,color:"#111"}],showShadow:!0,shadowBlur:10,shadowColor:"#00ffff"},d=(e(a,[{key:"draw",value:function(){var t=this.ctx,e=this.curvePoints,o=this.renderOpts;t&&_.isArray(e)&&(_.isEmpty(o)||n.initCurveStyle(t,o),n.drawCurveByNodes(t,e))}}]),a);function a(t,e,o){r(this,a),this.ctx=t,this.nodes=e,this.renderOpts=o,this.curvePoints=n.calculateCurveNodes(e)}var n=(e(f,null,[{key:"calculateCurvePerNode",value:function(t,i){var a=void 0,l=void 0,n=void 0;return t.length?(a=l=0,n=t.length-1,t.forEach(function(t,e){var o=void 0,r=Math.pow(1-i,n-e)*Math.pow(i,e);o=0===e?r:s(n)/s(e)/s(n-e)*r,a+=t[0]*o,l+=t[1]*o}),[a,l]):[]}},{key:"createBezierCurve",value:function(t,e,o){return new d(t,e,o)}},{key:"initCurveStyle",value:function(t,e){if(t&&e){var o=void 0;o=e?_.extend({},l,e):_.extend({},l);var r=void 0;t.lineWidth=o.lineWidth||1,o.lineCap&&(t.lineCap=o.lineCap);var i=o.colors;if(_.isString(i))t.strokeStyle=i;else if(o.useGradient&&_.isArray(i)){var a=function(t){var e=void 0;if(t&&_.isArray(t)){var o,r,i=[],a=[];t.forEach(function(t){i.push(t[0]),a.push(t[1])}),o=_.sortBy(i),r=_.sortBy(a);var l=o.length-1,n=r.length-1;e=[o[0],r[0],o[l],r[n]]}return e}(nodes);r=a?t.createLinearGradient(a[0],a[1],a[2],a[3]):t.createLinearGradient(0,0,0,200),i.forEach(function(t){r.addColorStop(t.stop,t.color)}),t.strokeStyle=r}o.showShadow&&(t.shadowBlur=o.shadowBlur||10,o.shadowColor&&(t.shadowColor=o.shadowColor))}}},{key:"drawCurve",value:function(t,e,o,r){var i=3<arguments.length&&void 0!==r&&r,a=void 0;if(t&&e&&_.isArray(e)&&e.length){var l=e.length,n=void 0,s=void 0;if(f.initCurveStyle(t,o),a=f.calculateCurveNodes(e),2!==l||i)if(3!==l||i)if(4!==l||i)f.drawCurveByNodes(t,a);else{var h,u;n=e[0],h=e[1],u=e[2],s=e[3],t.beginPath(),t.moveTo(n[0],n[1]),t.bezierCurveTo(h[0],h[1],u[0],u[1],s[0],s[1]),t.stroke()}else{var c;n=e[0],c=e[1],s=e[2],t.beginPath(),t.moveTo(n[0],n[1]),t.quadraticCurveTo(c[0],c[1],s[0],s[1]),t.stroke()}else n=e[0],s=e[1],_.isArray(n)&&_.isArray(s)&&(t.beginPath(),t.moveTo(n[0],n[1]),t.lineTo(s[0],s[1]),t.stroke());t.closePath()}return new d(t,e,a)}},{key:"calculateCurveNodes",value:function(t){var e=[],o=void 0;if(t&&_.isArray(t)){o=1/(2===t.length?50:200);for(var r=0;r<1;r+=o)e.push(f.calculateCurvePerNode(t,r));e.push(t[t.length-1])}return e}},{key:"drawCurveByNodes",value:function(r,i){if(_.isArray(i)){var t=r.shadowBlur,e=function(){i.forEach(function(t,e){if(e){var o=i[e-1];r.beginPath(),r.moveTo(o[0],o[1]),r.lineTo(t[0],t[1]),r.stroke()}})};e(),r.shadowBlur=0,e(),r.shadowBlur=t}}}]),f);function f(){r(this,f)}return t.default=n,t}(window.BezierCurveUtil));